<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>获取播放地址</title>
  <script type="text/javascript" src="../js/syntaxhighlighter.js"></script>
  <link type="text/css" rel="stylesheet" href="../css/monokai.css">
</head>
<body>
<script type="text/syntaxhighlighter" class="brush: aar"><![CDATA[
// ${name: getUrl}
// ${title: 获取播放地址}

import console;
import web.json; 
import web.rest.client

_url = "https://wx.vzan.com/live/tvchat-405180913?jumpitd=1"

var http = web.rest.client();
var getUrl = http.api(_url,"GET",function(ret){
    var hlsUrl = string.match( ret, "hlsUrl\s=\s\'(.+?)\'" );
	var json = web.json.parse( string.match(ret, "RedBag\:\s(\{.+?\})") )
	var t = string.split(hlsUrl,'/')
	return string.format(
		"https://i3.vzan.cc/clip/%s/%s/%s"
		,json.liveId ,json.topicId ,t[#t]
	)
})

console.log( getUrl() ) 

console.pause(true);

// https://suiang.cn/aardio/code/getUrl.html
]]></script>
</body>
</html>
